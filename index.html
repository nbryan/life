<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="stylesheet.css" />
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script type="text/javascript" src="life.js"></script>
    <script type="text/javascript" src="boards.js"></script>
    <script type="text/javascript">
      //<![CDATA[
      
      var ROWS = 40;
      var COLS = 60;
      
      var controller = (function() {
        this.life = new Life(ROWS, COLS);
        this.running = false;
        
        this.start = function() {
          
        },
        
        this.stop = function() {
          
        }
        
        this.reset = function(rows, cols, board) {
          if (board) {
            this.life = new Life(rows, cols, eval(board));
          else {
            this.life = new Life(rows, cols);
          }
        }
        
      })();
      
      $(document).ready(function() {
        var life = new Life(40, 60);
        //var life = new Life(40, 60, Life.patterns.gosperGliderGun);
        var interval;
        
        initBoard(life);
        initPatterns();
        updateBoard(life);
        
        $("#start").click(function() {
          $(this).hide();
          $("#stop").show();
          interval = setInterval(function() { nextGeneration(life); }, 400);
        });
        
        $("#stop").click(function() {
          $(this).hide();
          $("#start").show();
          clearInterval(interval);
        });
        
        $("#reset").click(function() {
          
        });
        
        $("#board table tr").each(function(row) {
          $("td", this).each(function(col) {
            $(this).click(function() {
              life.board[row][col] = !life.board[row][col];
              updateCell(this, life.board[row][col]);
            });
          });
        });
      });
      
      function nextGeneration(life) {
        life.tick();
        updateBoard(life);
      }
      
      function initBoard(life) {
        var board = "<table>";
        for (var row = 0; row < life.rows; row++) {
          board += "<tr>";
          for (var col = 0; col < life.cols; col++) {
            board += "<td></td>";
          }
          board += "</tr>"
        }
        board += "</table>"
        $("#board").html(board);
      }
      
      function initPatterns() {
        var options = "<option value=\"\">Empty</option>";
        for (group in Life.patternGroups) {
          options += "<optgroup label=\"" + group + "\">";
          for (pattern in Life.patternGroups[group]) {
            options += "<option value=\"" + Life.patternGroups[group][pattern] + "\">" + pattern + "</option>";
          }
          options += "</optgroup>";
        }
        $("#pattern").html(options)
      }
      
      function updateBoard(life) {
        $("#board table tr").each(function(row) {
          $("td", this).each(function(col) {
            updateCell(this, life.board[row][col]);
          });
        });
      }
      
      function updateCell(cell, alive) {
        $(cell).attr("class", alive ? "alive" : "dead")
      }
      
      //]]>
    </script>
  </head>
  <body>
    <div id="wrapper">
      <h1>The [JavaScript] Game of Life</h1>
      <div id="board"></div>
      <div id="controls">
        <div id="start-stop-controls">
          <input id="start" class="button" type="button" value="Start" />
          <input id="stop" class="button" type="button" value="Stop" style="display:none;" />
        </div>
        <div id="reset-controls">
          <label>Initial Pattern:
            <select id="pattern"></select>
          </label>
          <input id="reset" class="button" type="button" value="Reset Game" />
        </div>
      </div>
    </div>
  </body>
</html>